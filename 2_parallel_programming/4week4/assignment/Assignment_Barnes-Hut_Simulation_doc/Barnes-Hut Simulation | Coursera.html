<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 7.0.1 (456247)"/><meta name="author" content="Marc K"/><meta name="created" content="2018-02-25 17:45:27 +0000"/><meta name="source" content="web.clip"/><meta name="source-url" content="https://www.coursera.org/learn/parprog1/programming/xGkV0/barnes-hut-simulation"/><meta name="updated" content="2018-02-25 18:00:40 +0000"/><title>Barnes-Hut Simulation | Coursera</title></head><body><div style="-evernote-webclip: true;"><div><h2 style="font-weight: normal; font-family: 'OpenSans', Arial, sans-serif;">Programming Assignment: Barnes-Hut Simulation</h2></div><div style="font-size: 16px; display: inline-block;"><div><div style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;"><div><div><div><div style="height: 100%;"><div><div><div><div><div><div><div><div><div><div><div><div><div><div><div><span>You have not submitted. You must earn 8/10 points to pass.</span></div></div></div></div><table style="font-size: inherit; font-weight: inherit; font-style: inherit; font-variant: inherit;"><tr><td colspan="1" rowspan="1"><strong>Deadline</strong></td><td colspan="1" rowspan="1"><div>Pass this assignment by February 25, 11:59 PM PST</div></td></tr></table><div><div><div><ol><li><a shape="rect" href="https://www.coursera.org/learn/parprog1/programming/xGkV0/barnes-hut-simulation" target="_blank">Instructions</a><br clear="none"/></li><li><a shape="rect" href="https://www.coursera.org/learn/parprog1/programming/xGkV0/barnes-hut-simulation/submission" target="_blank">My submission</a><br clear="none"/></li><li><a shape="rect" href="https://www.coursera.org/learn/parprog1/programming/xGkV0/barnes-hut-simulation/discussions" target="_blank">Discussions</a><br clear="none"/></li></ol></div></div></div><div><div><div><div><div><div><div><div><div><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;"><strong>Note: If you have paid for the Certificate, please make sure you are submitting to the required assessment and not the optional assessment. If you mistakenly use the token from the wrong assignment, your grades will not appear</strong></p><h1 style="font-weight: normal; margin-top: 10px; margin-bottom: 10px; font-family: 'OpenSans-Light', Arial, sans-serif; font-size: 32px; line-height: 36px;">Barnes-Hut Simulation</h1><h3 style="font-weight: normal; font-family: 'OpenSans', Arial, sans-serif; font-size: 16px; line-height: 24px;"><a shape="rect" href="http://alaska.epfl.ch/~dockermoocs/parprog1/barneshut.zip" target="_blank" rel="noopener nofollow">First, start by downloading the assignment zip file.</a><br clear="none"/></h3><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">In this assignment, you will implement the parallel Barnes-Hut algorithm for <em>N-body simulation</em>. N-body simulation is a simulation of a system of <em>N</em> particles that interact with physical forces, such as gravity or electrostatic force. Given initial positions and velocities of all the <em>particles</em> (or <em>bodies</em>), the N-body simulation computes the new positions and velocities of the particles as the time progresses. It does so by dividing time into discrete short intervals, and computing the positions of the particles after each interval.</p><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">Before we study the Barnes-Hut algorithm for the N-body simulation problem, we will focus on a simpler algorithm -- the <em>direct sum N-body algorithm</em>. The direct sum algorithm consists of multiple iterations, each of which performs the following steps for each particle:</p><ol><li>The particle position is updated according to its current velocity (<strong>delta</strong> is a short time period).</li></ol><div style="position: relative; overflow: hidden; font: normal normal normal normal 12px 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', 'source-code-pro', monospace; direction: ltr; background-color: #ffffff; color: #4d4d4c; height: 50px;"><div style="position: absolute; overflow: hidden; width: auto; top: 0px; bottom: 0px; left: 0px; cursor: default; z-index: 4; background: #f6f6f6 none repeat scroll 0% 0%; color: #4d4d4c;"><div style="z-index: 1; position: relative; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 80px; width: 41px; box-sizing: border-box; pointer-events: auto; text-align: right; margin-top: 0px;"><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">1</div><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">2</div></div><div style="position: absolute; left: 0px; right: 0px; background-color: #dcdcdc; top: 16px; height: 16px;"><br clear="none"/></div></div><div style="position: absolute; overflow: hidden; top: 0px; bottom: 0px; background-color: inherit; cursor: text; left: 41px; right: 0px;"><div style="position: absolute; box-sizing: border-box; min-width: 100%; margin-top: 0px; width: 542px; height: 80px; margin-left: 0px;"><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><div style="position: absolute; height: 100%; width: 1px; background: #f6f6f6 none repeat scroll 0% 0%; left: 580px; visibility: visible;"><br clear="none"/></div></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><br clear="none"/></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none; font: inherit; padding: 0px 4px;"><div style="height: 16px;"><div style="height: 16px;"><span>x</span>' <span style="color: #3e999f;">=</span> <span>x</span> <span style="color: #3e999f;">+</span> <span>v_x</span> <span style="color: #3e999f;">*</span> <span>delta</span></div></div><div style="height: 16px;"><div style="height: 16px;"><span>y</span>' <span style="color: #3e999f;">=</span> <span>y</span> <span style="color: #3e999f;">+</span> <span>v_y</span> <span style="color: #3e999f;">*</span> <span>delta</span></div></div></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><br clear="none"/></div><div style="z-index: 4; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><div style="z-index: 4; position: absolute; box-sizing: border-box; border-left: 2px solid; transform: translateZ(0px); opacity: 0.2; color: #aeafad; left: 148px; top: 16px; width: 7.2px; height: 16px;"><br clear="none"/></div></div></div></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: visible;"><br clear="none"/></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; font-size-adjust: inherit; font-kerning: inherit; font-language-override: inherit; font-feature-settings: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">2. The net force on the particle is computed by adding the individual forces from all the other particles.</p><div style="position: relative; overflow: hidden; font: normal normal normal normal 12px 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', 'source-code-pro', monospace; direction: ltr; background-color: #ffffff; color: #4d4d4c; height: 50px;"><div style="position: absolute; overflow: hidden; width: auto; top: 0px; bottom: 0px; left: 0px; cursor: default; z-index: 4; background: #f6f6f6 none repeat scroll 0% 0%; color: #4d4d4c;"><div style="z-index: 1; position: relative; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 80px; width: 41px; box-sizing: border-box; pointer-events: auto; text-align: right; margin-top: 0px;"><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">1</div><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">2</div></div><div style="position: absolute; left: 0px; right: 0px; background-color: #dcdcdc; top: 16px; height: 16px;"><br clear="none"/></div></div><div style="position: absolute; overflow: hidden; top: 0px; bottom: 0px; background-color: inherit; cursor: text; left: 41px; right: 0px;"><div style="position: absolute; box-sizing: border-box; min-width: 100%; margin-top: 0px; width: 542px; height: 80px; margin-left: 0px;"><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><div style="position: absolute; height: 100%; width: 1px; background: #f6f6f6 none repeat scroll 0% 0%; left: 580px; visibility: visible;"><br clear="none"/></div></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><br clear="none"/></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none; font: inherit; padding: 0px 4px;"><div style="height: 16px;"><div style="height: 16px;"><span>F_x</span> <span style="color: #3e999f;">=</span> <span>F_1x</span> <span style="color: #3e999f;">+</span> <span>F_2x</span> <span style="color: #3e999f;">+</span> <span>F_3x</span> <span style="color: #3e999f;">+</span> ... <span style="color: #3e999f;">+</span> <span>F_Nx</span></div></div><div style="height: 16px;"><div style="height: 16px;"><span>F_y</span> <span style="color: #3e999f;">=</span> <span>F_1y</span> <span style="color: #3e999f;">+</span> <span>F_2y</span> <span style="color: #3e999f;">+</span> <span>F_3y</span> <span style="color: #3e999f;">+</span> ... <span style="color: #3e999f;">+</span> <span>F_Ny</span></div></div></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><br clear="none"/></div><div style="z-index: 4; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><div style="z-index: 4; position: absolute; box-sizing: border-box; border-left: 2px solid; transform: translateZ(0px); opacity: 0.2; color: #aeafad; left: 270.4px; top: 16px; width: 7.2px; height: 16px;"><br clear="none"/></div></div></div></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: visible;"><br clear="none"/></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; font-size-adjust: inherit; font-kerning: inherit; font-language-override: inherit; font-feature-settings: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">3. The particle velocity is updated according to the net force on that particle.</p><div style="position: relative; overflow: hidden; font: normal normal normal normal 12px 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', 'source-code-pro', monospace; direction: ltr; background-color: #ffffff; color: #4d4d4c; height: 50px;"><div style="position: absolute; overflow: hidden; width: auto; top: 0px; bottom: 0px; left: 0px; cursor: default; z-index: 4; background: #f6f6f6 none repeat scroll 0% 0%; color: #4d4d4c;"><div style="z-index: 1; position: relative; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 80px; width: 41px; box-sizing: border-box; pointer-events: auto; text-align: right; margin-top: 0px;"><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">1</div><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">2</div></div><div style="position: absolute; left: 0px; right: 0px; background-color: #dcdcdc; top: 16px; height: 16px;"><br clear="none"/></div></div><div style="position: absolute; overflow: hidden; top: 0px; bottom: 0px; background-color: inherit; cursor: text; left: 41px; right: 0px;"><div style="position: absolute; box-sizing: border-box; min-width: 100%; margin-top: 0px; width: 542px; height: 80px; margin-left: 0px;"><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><div style="position: absolute; height: 100%; width: 1px; background: #f6f6f6 none repeat scroll 0% 0%; left: 580px; visibility: visible;"><br clear="none"/></div></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><br clear="none"/></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none; font: inherit; padding: 0px 4px;"><div style="height: 16px;"><div style="height: 16px;"><span>v_x</span>' <span style="color: #3e999f;">=</span> <span>v_x</span> <span style="color: #3e999f;">+</span> <span>F_x</span> / <span>mass</span> <span style="color: #3e999f;">*</span> <span>delta</span></div></div><div style="height: 16px;"><div style="height: 16px;"><span>v_y</span>' <span style="color: #3e999f;">=</span> <span>v_y</span> <span style="color: #3e999f;">+</span> <span>F_y</span> / <span>mass</span> <span style="color: #3e999f;">*</span> <span>delta</span></div></div></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><br clear="none"/></div><div style="z-index: 4; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><div style="z-index: 4; position: absolute; box-sizing: border-box; border-left: 2px solid; transform: translateZ(0px); opacity: 0.2; color: #aeafad; left: 227.2px; top: 16px; width: 7.2px; height: 16px;"><br clear="none"/></div></div></div></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: visible;"><br clear="none"/></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; font-size-adjust: inherit; font-kerning: inherit; font-language-override: inherit; font-feature-settings: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">In this exercise, we will assume that the force between particles is the <em>gravitational force</em> from classical mechanics. Let's recall the formula for the gravitational force between two stellar bodies:</p><div style="position: relative; overflow: hidden; font: normal normal normal normal 12px 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', 'source-code-pro', monospace; direction: ltr; background-color: #ffffff; color: #4d4d4c; height: 50px;"><div style="position: absolute; overflow: hidden; width: auto; top: 0px; bottom: 0px; left: 0px; cursor: default; z-index: 4; background: #f6f6f6 none repeat scroll 0% 0%; color: #4d4d4c;"><div style="z-index: 1; position: relative; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 80px; width: 41px; box-sizing: border-box; pointer-events: auto; text-align: right; margin-top: 0px;"><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">1</div></div><div style="position: absolute; left: 0px; right: 0px; background-color: #dcdcdc; top: 0px; height: 16px;"><br clear="none"/></div></div><div style="position: absolute; overflow: hidden; top: 0px; bottom: 0px; background-color: inherit; cursor: text; left: 41px; right: 0px;"><div style="position: absolute; box-sizing: border-box; min-width: 100%; margin-top: 0px; width: 542px; height: 80px; margin-left: 0px;"><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><div style="position: absolute; height: 100%; width: 1px; background: #f6f6f6 none repeat scroll 0% 0%; left: 580px; visibility: visible;"><br clear="none"/></div></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><br clear="none"/></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none; font: inherit; padding: 0px 4px;"><div style="height: 16px;"><div style="height: 16px;">F = G * (m1 * m2) / distance^2</div></div></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><br clear="none"/></div><div style="z-index: 4; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><div style="z-index: 4; position: absolute; box-sizing: border-box; border-left: 2px solid; transform: translateZ(0px); opacity: 0.2; color: #aeafad; left: 220px; top: 0px; width: 7.2px; height: 16px;"><br clear="none"/></div></div></div></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: visible;"><br clear="none"/></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; font-size-adjust: inherit; font-kerning: inherit; font-language-override: inherit; font-feature-settings: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">Above, <strong>F</strong> is the absolute value of the gravitational force, <strong>m1</strong> and <strong>m2</strong> are the masses of the two bodies, and<strong> r</strong> is the distance between them. <strong>G</strong> is the gravitational constant.</p><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">For each particle, the net force is computed by summing the components of individual forces from all other particles, as shown in the following figure:</p><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;"><br clear="none"/></p><div><img src="Barnes-Hut%20Simulation%20%7C%20Coursera.resources/6Ra7zNoJEeWv6g6eMxXZ9Q_9ec3b447a8579bf18d18ab0644255ae9_net-force.png" height="303" width="450"/></div><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">The direct sum N-body algorithm is very simple, but also inefficient. Since we need to update <strong>N</strong> particles, and compute<strong> N - 1</strong> force contributions for each of those particles, the overall complexity of an iteration step of this algorithm is <strong>O(N^2)</strong>. As the number of particles grows larger, the direct sum N-body algorithm becomes prohibitively expensive.</p><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">The Barnes-Hut algorithm is an optimization of the direct sum N-body algorithm, and is based on the following observation:</p><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;"><em>If a cluster of bodies is sufficiently distant from a body A, the net force on A from that cluster can be approximated with one big body with the mass of all the bodies in the cluster, positioned at the center of mass of the cluster.</em></p><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">This is illustrated in the following figure:</p><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;"><br clear="none"/></p><div><img src="Barnes-Hut%20Simulation%20%7C%20Coursera.resources/825JRdoJEeWpPxJCasCIbQ_8274e76845138640aa3e634060c0f543_observation.png" height="323" width="450"/></div><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">To take advantage of this observation, the Barnes-Hut algorithm relies on a <em>quadtree</em> -- a data structure that divides the space into cells, and answers queries such as 'What is the total mass and the center of mass of all the particles in this cell?'. The following figure shows an example of a quadtree for 6 bodies:</p><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;"><br clear="none"/></p><div><img src="Barnes-Hut%20Simulation%20%7C%20Coursera.resources/KEtOZ9oKEeWpPxJCasCIbQ_c53538e2ed7d7b243ef9feebc2a0eb4c_quadtree.png" height="674" width="650"/></div><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">Above, the total force from the bodies <em>B</em>, <em>C</em>, <em>D</em> and <em>E</em> on the body <em>A</em> can be approximated by a single body with <em>mass</em> equal to the sum of masses <em>B</em>, <em>C</em>, <em>D</em> and <em>E</em>, positioned at the center of mass of bodies <em>B</em>, <em>C</em>, <em>D</em> and <em>E</em>. The center of mass <strong>(massX, massY)</strong> is computed as follows:</p><div style="position: relative; overflow: hidden; font: normal normal normal normal 12px 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', 'source-code-pro', monospace; direction: ltr; background-color: #ffffff; color: #4d4d4c; height: 50px;"><div style="position: absolute; overflow: hidden; width: auto; top: 0px; bottom: 0px; left: 0px; cursor: default; z-index: 4; background: #f6f6f6 none repeat scroll 0% 0%; color: #4d4d4c;"><div style="z-index: 1; position: relative; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 80px; width: 41px; box-sizing: border-box; pointer-events: auto; text-align: right; margin-top: 0px;"><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">1</div><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">2</div><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">3</div></div><div style="position: absolute; left: 0px; right: 0px; background-color: #dcdcdc; top: 32px; height: 16px;"><br clear="none"/></div></div><div style="position: absolute; overflow: hidden; top: 0px; bottom: 0px; background-color: inherit; cursor: text; left: 41px; right: 0px;"><div style="position: absolute; box-sizing: border-box; min-width: 100%; margin-top: 0px; width: 542px; height: 80px; margin-left: 0px;"><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><div style="position: absolute; height: 100%; width: 1px; background: #f6f6f6 none repeat scroll 0% 0%; left: 580px; visibility: visible;"><br clear="none"/></div></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><br clear="none"/></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none; font: inherit; padding: 0px 4px;"><div style="height: 16px;"><div style="height: 16px;">mass = m_B + m_C + m_D + m_E</div></div><div style="height: 16px;"><div style="height: 16px;">massX = (m_B * x_B + m_C * x_C + m_D * x_D + m_E * x_E) / mass</div></div><div style="height: 16px;"><div style="height: 16px;">massY = (m_B * y_B + m_C * y_C + m_D * y_D + m_E * y_E) / mass</div></div></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><br clear="none"/></div><div style="z-index: 4; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><div style="z-index: 4; position: absolute; box-sizing: border-box; border-left: 2px solid; transform: translateZ(0px); opacity: 0.2; color: #aeafad; left: 450.4px; top: 32px; width: 7.2px; height: 16px;"><br clear="none"/></div></div></div></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: visible;"><br clear="none"/></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; font-size-adjust: inherit; font-kerning: inherit; font-language-override: inherit; font-feature-settings: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">An iteration of the Barnes-Hut algorithm is composed of the following steps:</p><ol><li>Construct the quadtree for the current arrangement of the bodies.</li></ol><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">i. Determine the <em>boundaries</em>, i.e. the square into which all bodies fit.</p><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">ii. Construct a quadtree that covers the boundaries and contains all the bodies.</p><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">2. Update the bodies -- for each body:</p><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">i. Update the body position according to its current velocity.</p><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">ii. Using the quadtree, compute the net force on the body by adding the individual forces from all the other bodies.</p><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">iii. Update the velocity according to the net force on that body.</p><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">It turns out that, for most spatial distribution of bodies, the expected number of cells that contribute to the net force on a body is <strong>log n</strong>, so the overall complexity of the Barnes-Hut algorithm is <strong>O(n log n)</strong>.</p><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">Now that we covered all the necessary theory, let's finally dig into the implementation! You will implement:</p><ul><li>a quadtree and its combiner data structure</li><li>an operation that computes the total force on a body using the quadtree</li><li>a simulation step of the Barnes-Hut algorithm</li></ul><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">Since this assignment consists of multiple components, we will follow the principles of <em>test-driven development</em> and test each component separately, before moving on to the next component. That way, if anything goes wrong, we will more precisely know where the error is. It is always better to detect errors sooner, rather than later.</p><h2 style="font-weight: normal; margin-bottom: 10px; font-family: 'OpenSans', Arial, sans-serif; font-size: 22px; line-height: 24px;">Data Structures</h2><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">We will start by implementing the necessary data structures: the quadtree, the body data-type and the sector matrix. You will find the stubs in the <strong>package.scala</strong> file of the <strong>barneshut</strong> package.</p><h3 style="font-weight: normal; font-family: 'OpenSans', Arial, sans-serif; font-size: 16px; line-height: 24px;">Quadtree Data Structure</h3><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">In this part of the assignment, we implement the quadtree data structure, denoted with the abstract data-type Quad. Every Quad represents a square cell of space, and can be one of the following node types:</p><ul><li>an <strong>Empty</strong> node, which represents an empty quadtree</li><li>a <strong>Leaf</strong> node, which represents one or more bodies</li><li>a <strong>Fork</strong> node, which divides a spatial cell into four quadrants</li></ul><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">The definition of <strong>Quad</strong> is as follows:</p><div style="position: relative; overflow: hidden; font: normal normal normal normal 12px 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', 'source-code-pro', monospace; direction: ltr; background-color: #ffffff; color: #4d4d4c; height: 162px;"><div style="position: absolute; overflow: hidden; width: auto; top: 0px; bottom: 0px; left: 0px; cursor: default; z-index: 4; background: #f6f6f6 none repeat scroll 0% 0%; color: #4d4d4c;"><div style="z-index: 1; position: relative; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 192px; width: 48px; box-sizing: border-box; pointer-events: auto; text-align: right; margin-top: 0px;"><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">1<span style="box-sizing: border-box; margin: 0px -12px 0px 1px; width: 11px; vertical-align: top; background-image: url(data:image/png; base64,ivborw0kggoaaaansuheugaaaauaaaafcayaaacnbyblaaaaneleqvr42mwksq0amazc8ixllrzqjzmbiejp0a6wwbcspgkaxolkqsot7nn3ymwr7pz32nzpkkvodbuxkaaaaabjru5erkjggg==&amp;quot;);background-repeat: no-repeat; background-position: center center; border-radius: 3px; border: 1px solid transparent; cursor: pointer; display: inline-block; height: 16px;"/></div><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">2</div><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">3</div><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">4</div><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">5</div><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">6</div><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">7</div><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">8</div><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">9</div><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">10</div></div><div style="position: absolute; left: 0px; right: 0px; background-color: #dcdcdc; top: 144px; height: 16px;"><br clear="none"/></div></div><div style="position: absolute; overflow: hidden; top: 0px; bottom: 0px; background-color: inherit; cursor: text; left: 48px; right: 0px;"><div style="position: absolute; box-sizing: border-box; min-width: 100%; margin-top: 0px; width: 535px; height: 192px; margin-left: 0px;"><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><div style="position: absolute; height: 100%; width: 1px; background: #f6f6f6 none repeat scroll 0% 0%; left: 580px; visibility: visible;"><br clear="none"/></div></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><div style="border-radius: 3px; position: absolute; z-index: 6; margin: -1px 0px 0px -1px; border: 1px solid #d1d1d1; height: 16px; width: 7.2px; top: 0px; left: 198.4px;"><br clear="none"/></div></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none; font: inherit; padding: 0px 4px;"><div style="height: 16px;"><div style="height: 16px;"><span style="color: #8959a8;">sealed</span> <span style="color: #8959a8;">abstract</span> <span style="color: #8959a8;">class</span> <span>Quad</span> <span>{</span></div></div><div style="height: 16px;"><div style="height: 16px;"><span style="color: #8959a8;">def</span> <span>massX</span>: <span style="color: #4271ae;">Float</span></div></div><div style="height: 16px;"><div style="height: 16px;"><span style="color: #8959a8;">def</span> <span>massY</span>: <span style="color: #4271ae;">Float</span></div></div><div style="height: 16px;"><div style="height: 16px;"><span style="color: #8959a8;">def</span> <span>mass</span>: <span style="color: #4271ae;">Float</span></div></div><div style="height: 16px;"><div style="height: 16px;"><span style="color: #8959a8;">def</span> <span>centerX</span>: <span style="color: #4271ae;">Float</span></div></div><div style="height: 16px;"><div style="height: 16px;"><span style="color: #8959a8;">def</span> <span>centerY</span>: <span style="color: #4271ae;">Float</span></div></div><div style="height: 16px;"><div style="height: 16px;"><span style="color: #8959a8;">def</span> <span>size</span>: <span style="color: #4271ae;">Float</span></div></div><div style="height: 16px;"><div style="height: 16px;"><span style="color: #8959a8;">def</span> <span>total</span>: <span style="color: #4271ae;">Int</span></div></div><div style="height: 16px;"><div style="height: 16px;"><span style="color: #8959a8;">def</span> <span>insert</span><span>(</span><span>b</span>: <span>Body</span><span>)</span>: <span>Quad</span></div></div><div style="height: 16px;"><div style="height: 16px;"><span>}</span></div></div></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><br clear="none"/></div><div style="z-index: 4; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><div style="z-index: 4; position: absolute; box-sizing: border-box; border-left: 2px solid; transform: translateZ(0px); opacity: 0.2; color: #aeafad; left: 11.2px; top: 144px; width: 7.2px; height: 16px;"><br clear="none"/></div></div></div></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: visible;"><br clear="none"/></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; font-size-adjust: inherit; font-kerning: inherit; font-language-override: inherit; font-feature-settings: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">Here, <strong>massX</strong> and<strong> massY</strong> represent the center of mass of the bodies in the respective cell,<strong> mass</strong> is the total mass of bodies in that cell, <strong>centerX</strong> and <strong>centerY</strong> are the coordinates of the center of the cell, <strong>size</strong> is the length of the side of the cell, and <strong>total</strong> is the total number of bodies in the cell.</p><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">Note that we consider the top left corner to be at coordinate (0, 0). We also consider the x axis to grow to the right and the y axis to the bottom.</p><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;"><br clear="none"/></p><div><img src="Barnes-Hut%20Simulation%20%7C%20Coursera.resources/ND9N1NoKEeW7_xJajfx_vw_0f8f7980185a0cfeb435d9f4a2d27cee_cell.png" height="241" width="288"/></div><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">The method <strong>insert</strong> creates a new quadtree which additionally contains the body <strong>b</strong>, and covers the same area in space as the original quadtree. Quadtree is an <em>immutable</em> data structure -- <strong>insert</strong> does not modify the existing <strong>Quad</strong> object. Note that <strong>Body</strong> has the following signature:</p><div style="position: relative; overflow: hidden; font: normal normal normal normal 12px 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', 'source-code-pro', monospace; direction: ltr; background-color: #ffffff; color: #4d4d4c; height: 50px;"><div style="position: absolute; overflow: hidden; width: auto; top: 0px; bottom: 0px; left: 0px; cursor: default; z-index: 4; background: #f6f6f6 none repeat scroll 0% 0%; color: #4d4d4c;"><div style="z-index: 1; position: relative; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 112px; width: 41px; box-sizing: border-box; pointer-events: auto; text-align: right; margin-top: 0px;"><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 32px;">1</div></div><div style="position: absolute; left: 0px; right: 0px; background-color: #dcdcdc; top: 0px; height: 32px;"><br clear="none"/></div></div><div style="position: absolute; overflow: hidden; top: 0px; bottom: 0px; background-color: inherit; cursor: text; left: 41px; right: 0px;"><div style="position: absolute; box-sizing: border-box; min-width: 100%; margin-top: 0px; width: 542px; height: 112px; margin-left: 0px;"><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><div style="position: absolute; height: 100%; width: 1px; background: #f6f6f6 none repeat scroll 0% 0%; left: 580px; visibility: visible;"><br clear="none"/></div></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><div style="border-radius: 3px; position: absolute; z-index: 6; margin: -1px 0px 0px -1px; border: 1px solid #d1d1d1; height: 16px; width: 7.2px; top: 0px; left: 76px;"><br clear="none"/></div></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none; font: inherit; padding: 0px 4px;"><div style="height: 32px;"><div style="height: 16px;"><span style="color: #8959a8;">class</span> <span>Body</span><span>(</span><span style="color: #8959a8;">val</span> <span>mass</span>: <span style="color: #4271ae;">Float</span>, <span style="color: #8959a8;">val</span> <span>x</span>: <span style="color: #4271ae;">Float</span>, <span style="color: #8959a8;">val</span> <span>y</span>: <span style="color: #4271ae;">Float</span>, <span style="color: #8959a8;">val</span> <span>xspeed</span>: <span style="color: #4271ae;">Float</span>,</div><div style="height: 16px;">  <span style="color: #8959a8;">val</span> <span>yspeed</span>: <span style="color: #4271ae;">Float</span><span>)</span></div></div></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><br clear="none"/></div><div style="z-index: 4; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><div style="z-index: 4; position: absolute; box-sizing: border-box; border-left: 2px solid; transform: translateZ(0px); opacity: 0.2; color: #aeafad; left: 148px; top: 16px; width: 7.2px; height: 16px;"><br clear="none"/></div></div></div></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: visible;"><br clear="none"/></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; font-size-adjust: inherit; font-kerning: inherit; font-language-override: inherit; font-feature-settings: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">In this part of the exercise, you only need to know about body's position x and y.</p><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">Let's start by implementing the simplest <strong>Quad</strong> type -- the empty quadtree:</p><div style="position: relative; overflow: hidden; font: normal normal normal normal 12px 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', 'source-code-pro', monospace; direction: ltr; background-color: #ffffff; color: #4d4d4c; height: 50px;"><div style="position: absolute; overflow: hidden; width: auto; top: 0px; bottom: 0px; left: 0px; cursor: default; z-index: 4; background: #f6f6f6 none repeat scroll 0% 0%; color: #4d4d4c;"><div style="z-index: 1; position: relative; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 80px; width: 41px; box-sizing: border-box; pointer-events: auto; text-align: right; margin-top: 0px;"><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">1</div></div><div style="position: absolute; left: 0px; right: 0px; background-color: #dcdcdc; top: 0px; height: 16px;"><br clear="none"/></div></div><div style="position: absolute; overflow: hidden; top: 0px; bottom: 0px; background-color: inherit; cursor: text; left: 41px; right: 0px;"><div style="position: absolute; box-sizing: border-box; min-width: 100%; margin-top: 0px; width: 542px; height: 80px; margin-left: 0px;"><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><div style="position: absolute; height: 100%; width: 1px; background: #f6f6f6 none repeat scroll 0% 0%; left: 580px; visibility: visible;"><br clear="none"/></div></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><br clear="none"/></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none; font: inherit; padding: 0px 4px;"><div style="height: 16px;"><div style="height: 16px;"><span style="color: #8959a8;">case</span> <span style="color: #8959a8;">class</span> <span>Empty</span><span>(</span><span>centerX</span>: <span style="color: #4271ae;">Float</span>, <span>centerY</span>: <span style="color: #4271ae;">Float</span>, <span>size</span>: <span style="color: #4271ae;">Float</span><span>)</span> <span style="color: #8959a8;">extends</span> <span>Quad</span></div></div></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><br clear="none"/></div><div style="z-index: 4; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><div style="z-index: 4; position: absolute; box-sizing: border-box; border-left: 2px solid; transform: translateZ(0px); opacity: 0.2; color: #aeafad; left: 536.8px; top: 0px; width: 7.2px; height: 16px;"><br clear="none"/></div></div></div></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: visible;"><br clear="none"/></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; font-size-adjust: inherit; font-kerning: inherit; font-language-override: inherit; font-feature-settings: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">The center and the size of the <strong>Empty</strong> quadtree are specified in its constructor. The Empty tree does not contain any bodies, so we specify that its center of mass is equal to its center.</p><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">Next, let's implement the <strong>Fork</strong> quadtree:</p><div style="position: relative; overflow: hidden; font: normal normal normal normal 12px 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', 'source-code-pro', monospace; direction: ltr; background-color: #ffffff; color: #4d4d4c; height: 50px;"><div style="position: absolute; overflow: hidden; width: auto; top: 0px; bottom: 0px; left: 0px; cursor: default; z-index: 4; background: #f6f6f6 none repeat scroll 0% 0%; color: #4d4d4c;"><div style="z-index: 1; position: relative; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 80px; width: 41px; box-sizing: border-box; pointer-events: auto; text-align: right; margin-top: 0px;"><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">1</div></div><div style="position: absolute; left: 0px; right: 0px; background-color: #dcdcdc; top: 0px; height: 16px;"><br clear="none"/></div></div><div style="position: absolute; overflow: hidden; top: 0px; bottom: 0px; background-color: inherit; cursor: text; left: 41px; right: 0px;"><div style="position: absolute; box-sizing: border-box; min-width: 100%; margin-top: 0px; width: 542px; height: 80px; margin-left: 0px;"><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><div style="position: absolute; height: 100%; width: 1px; background: #f6f6f6 none repeat scroll 0% 0%; left: 580px; visibility: visible;"><br clear="none"/></div></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><br clear="none"/></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none; font: inherit; padding: 0px 4px;"><div style="height: 16px;"><div style="height: 16px;"><span style="color: #8959a8;">case</span> <span style="color: #8959a8;">class</span> <span>Fork</span><span>(</span><span>nw</span>: <span>Quad</span>, <span>ne</span>: <span>Quad</span>, <span>sw</span>: <span>Quad</span>, <span>se</span>: <span>Quad</span><span>)</span> <span style="color: #8959a8;">extends</span> <span>Quad</span></div></div></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><br clear="none"/></div><div style="z-index: 4; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><div style="z-index: 4; position: absolute; box-sizing: border-box; border-left: 2px solid; transform: translateZ(0px); opacity: 0.2; color: #aeafad; left: 493.6px; top: 0px; width: 7.2px; height: 16px;"><br clear="none"/></div></div></div></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: visible;"><br clear="none"/></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; font-size-adjust: inherit; font-kerning: inherit; font-language-override: inherit; font-feature-settings: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">This node is specified by four child quadtrees <strong>nw</strong>, <strong>ne</strong>, <strong>sw</strong> and <strong>se</strong>, in the northwest, northeast, southwest and southeast quadrant, respectively.</p><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">The northwest is located on the top left, northeast on the top right, southwest on the bottom left and southeast on the bottom right.</p><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">The constructor assumes that the children nodes that represent four adjacent cells of the same size and adjacent to each other, as in the earlier figure. The center of the <strong>Fork</strong> quadtree is then specified by, say, the lower right corner of the quadtree <strong>nw</strong>. If the <strong>Fork</strong> quadtree is empty, the center of mass coincides with the center.</p><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">Inserting into a <strong>Fork</strong> is recursive -- it updates the respective child and creates a new <strong>Fork</strong>.</p><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">Finally, the <strong>Leaf</strong> quadtree represents one or more bodies:</p><div style="position: relative; overflow: hidden; font: normal normal normal normal 12px 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', 'source-code-pro', monospace; direction: ltr; background-color: #ffffff; color: #4d4d4c; height: 50px;"><div style="position: absolute; overflow: hidden; width: auto; top: 0px; bottom: 0px; left: 0px; cursor: default; z-index: 4; background: #f6f6f6 none repeat scroll 0% 0%; color: #4d4d4c;"><div style="z-index: 1; position: relative; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 96px; width: 41px; box-sizing: border-box; pointer-events: auto; text-align: right; margin-top: 0px;"><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 32px;">1</div><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">2</div></div><div style="position: absolute; left: 0px; right: 0px; background-color: #dcdcdc; top: 32px; height: 16px;"><br clear="none"/></div></div><div style="position: absolute; overflow: hidden; top: 0px; bottom: 0px; background-color: inherit; cursor: text; left: 41px; right: 0px;"><div style="position: absolute; box-sizing: border-box; min-width: 100%; margin-top: 0px; width: 542px; height: 96px; margin-left: 0px;"><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><div style="position: absolute; height: 100%; width: 1px; background: #f6f6f6 none repeat scroll 0% 0%; left: 580px; visibility: visible;"><br clear="none"/></div></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><br clear="none"/></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none; font: inherit; padding: 0px 4px;"><div style="height: 32px;"><div style="height: 16px;"><span style="color: #8959a8;">case</span> <span style="color: #8959a8;">class</span> <span>Leaf</span><span>(</span><span>centerX</span>: <span style="color: #4271ae;">Float</span>, <span>centerY</span>: <span style="color: #4271ae;">Float</span>, <span>size</span>: <span style="color: #4271ae;">Float</span>, <span>bodies</span>:</div><div style="height: 16px;">  <span style="color: #4271ae;">Seq</span><span>[</span><span>Body</span><span>])</span></div></div><div style="height: 16px;"><div style="height: 16px;"><span style="color: #8959a8;">extends</span> <span>Quad</span></div></div></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><br clear="none"/></div><div style="z-index: 4; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><div style="z-index: 4; position: absolute; box-sizing: border-box; border-left: 2px solid; transform: translateZ(0px); opacity: 0.2; color: #aeafad; left: 90.4px; top: 32px; width: 7.2px; height: 16px;"><br clear="none"/></div></div></div></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: visible;"><br clear="none"/></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; font-size-adjust: inherit; font-kerning: inherit; font-language-override: inherit; font-feature-settings: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">If the <strong>size</strong> of a <strong>Leaf</strong> is greater than a predefined constant <strong>minimumSize</strong>, inserting an additonal body into that <strong>Leaf</strong> quadtree creates a <strong>Fork</strong> quadtree with empty children, and adds all the bodies into that <strong>Fork</strong> (including the new body). Otherwise, inserting creates another <strong>Leaf</strong> with all the existing bodies and the new one.</p><h3 style="font-weight: normal; font-family: 'OpenSans', Arial, sans-serif; font-size: 16px; line-height: 24px;">The Body Data-Type</h3><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">Next, we can implement the <strong>Body</strong> data-type:</p><div style="position: relative; overflow: hidden; font: normal normal normal normal 12px 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', 'source-code-pro', monospace; direction: ltr; background-color: #ffffff; color: #4d4d4c; height: 66px;"><div style="position: absolute; overflow: hidden; width: auto; top: 0px; bottom: 0px; left: 0px; cursor: default; z-index: 4; background: #f6f6f6 none repeat scroll 0% 0%; color: #4d4d4c;"><div style="z-index: 1; position: relative; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 112px; width: 41px; box-sizing: border-box; pointer-events: auto; text-align: right; margin-top: 0px;"><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 32px;">1<span style="box-sizing: border-box; margin: 0px -12px 0px 1px; width: 11px; vertical-align: top; background-image: url(data:image/png; base64,ivborw0kggoaaaansuheugaaaauaaaafcayaaacnbyblaaaaneleqvr42mwksq0amazc8ixllrzqjzmbiejp0a6wwbcspgkaxolkqsot7nn3ymwr7pz32nzpkkvodbuxkaaaaabjru5erkjggg==&amp;quot;);background-repeat: no-repeat; background-position: center center; border-radius: 3px; border: 1px solid transparent; cursor: pointer; display: inline-block; height: 16px;"/></div><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">2</div><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">3</div></div><div style="position: absolute; left: 0px; right: 0px; background-color: #dcdcdc; top: 48px; height: 16px;"><br clear="none"/></div></div><div style="position: absolute; overflow: hidden; top: 0px; bottom: 0px; background-color: inherit; cursor: text; left: 41px; right: 0px;"><div style="position: absolute; box-sizing: border-box; min-width: 100%; margin-top: 0px; width: 542px; height: 112px; margin-left: 0px;"><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><div style="position: absolute; height: 100%; width: 1px; background: #f6f6f6 none repeat scroll 0% 0%; left: 580px; visibility: visible;"><br clear="none"/></div></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><div style="border-radius: 3px; position: absolute; z-index: 6; margin: -1px 0px 0px -1px; border: 1px solid #d1d1d1; height: 16px; width: 7.2px; top: 16px; left: 155.20000000000002px;"><br clear="none"/></div></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none; font: inherit; padding: 0px 4px;"><div style="height: 32px;"><div style="height: 16px;"><span style="color: #8959a8;">class</span> <span>Body</span><span>(</span><span style="color: #8959a8;">val</span> <span>mass</span>: <span style="color: #4271ae;">Float</span>, <span style="color: #8959a8;">val</span> <span>x</span>: <span style="color: #4271ae;">Float</span>, <span style="color: #8959a8;">val</span> <span>y</span>: <span style="color: #4271ae;">Float</span>, <span style="color: #8959a8;">val</span> <span>xspeed</span>: <span style="color: #4271ae;">Float</span>,</div><div style="height: 16px;">  <span style="color: #8959a8;">val</span> <span>yspeed</span>: <span style="color: #4271ae;">Float</span><span>)</span> <span>{</span></div></div><div style="height: 16px;"><div style="height: 16px;"><span style="color: #8959a8;">def</span> <span>updated</span><span>(</span><span>quad</span>: <span>Quad</span><span>)</span>: <span>Body</span> <span style="color: #3e999f;">=</span> ???</div></div><div style="height: 16px;"><div style="height: 16px;"><span>}</span></div></div></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><br clear="none"/></div><div style="z-index: 4; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><div style="z-index: 4; position: absolute; box-sizing: border-box; border-left: 2px solid; transform: translateZ(0px); opacity: 0.2; color: #aeafad; left: 11.2px; top: 48px; width: 7.2px; height: 16px;"><br clear="none"/></div></div></div></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: visible;"><br clear="none"/></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; font-size-adjust: inherit; font-kerning: inherit; font-language-override: inherit; font-feature-settings: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">Here, <strong>xspeed </strong>and <strong>yspeed</strong> represent the velocity of the body, <strong>mass</strong> is its mass, and <strong>x</strong> and <strong>y</strong> are the coordinates of the body.</p><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">The most interesting method on the <strong>Body</strong> is <strong>updated</strong> -- it takes a quadtree and returns the updated version of the <strong>Body</strong>:</p><div style="position: relative; overflow: hidden; font: normal normal normal normal 12px 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', 'source-code-pro', monospace; direction: ltr; background-color: #ffffff; color: #4d4d4c; height: 50px;"><div style="position: absolute; overflow: hidden; width: auto; top: 0px; bottom: 0px; left: 0px; cursor: default; z-index: 4; background: #f6f6f6 none repeat scroll 0% 0%; color: #4d4d4c;"><div style="z-index: 1; position: relative; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 80px; width: 41px; box-sizing: border-box; pointer-events: auto; text-align: right; margin-top: 0px;"><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">1</div></div><div style="position: absolute; left: 0px; right: 0px; background-color: #dcdcdc; top: 0px; height: 16px;"><br clear="none"/></div></div><div style="position: absolute; overflow: hidden; top: 0px; bottom: 0px; background-color: inherit; cursor: text; left: 41px; right: 0px;"><div style="position: absolute; box-sizing: border-box; min-width: 100%; margin-top: 0px; width: 542px; height: 80px; margin-left: 0px;"><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><div style="position: absolute; height: 100%; width: 1px; background: #f6f6f6 none repeat scroll 0% 0%; left: 580px; visibility: visible;"><br clear="none"/></div></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><br clear="none"/></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none; font: inherit; padding: 0px 4px;"><div style="height: 16px;"><div style="height: 16px;"><span style="color: #8959a8;">def</span> <span>updated</span><span>(</span><span>quad</span>: <span>Quad</span><span>)</span>: <span>Body</span></div></div></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><br clear="none"/></div><div style="z-index: 4; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><div style="z-index: 4; position: absolute; box-sizing: border-box; border-left: 2px solid; transform: translateZ(0px); opacity: 0.2; color: #aeafad; left: 212.8px; top: 0px; width: 7.2px; height: 16px;"><br clear="none"/></div></div></div></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: visible;"><br clear="none"/></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; font-size-adjust: inherit; font-kerning: inherit; font-language-override: inherit; font-feature-settings: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">This method is already half-completed for you -- you only need to implement its nested method <strong>traverse</strong>, which goes through the quadtree and proceeds casewise:</p><ul><li>empty quadtree does not affect the net force</li><li>each body in a leaf quadtree adds some net force</li><li>a fork quadtree that is sufficiently far away acts as a single point of mass</li><li>a fork quadtree that is not sufficiently far away must be recursively traversed</li></ul><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">When are we allowed to approximate a cluster of bodies with a single point? The heuristic that is used is that the size of the cell divided by the distance <strong>dist</strong> between the center of mass and the particle is less than some constant <strong>theta</strong>:</p><div style="position: relative; overflow: hidden; font: normal normal normal normal 12px 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', 'source-code-pro', monospace; direction: ltr; background-color: #ffffff; color: #4d4d4c; height: 50px;"><div style="position: absolute; overflow: hidden; width: auto; top: 0px; bottom: 0px; left: 0px; cursor: default; z-index: 4; background: #f6f6f6 none repeat scroll 0% 0%; color: #4d4d4c;"><div style="z-index: 1; position: relative; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 80px; width: 41px; box-sizing: border-box; pointer-events: auto; text-align: right; margin-top: 0px;"><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">1</div></div><div style="position: absolute; left: 0px; right: 0px; background-color: #dcdcdc; top: 0px; height: 16px;"><br clear="none"/></div></div><div style="position: absolute; overflow: hidden; top: 0px; bottom: 0px; background-color: inherit; cursor: text; left: 41px; right: 0px;"><div style="position: absolute; box-sizing: border-box; min-width: 100%; margin-top: 0px; width: 542px; height: 80px; margin-left: 0px;"><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><div style="position: absolute; height: 100%; width: 1px; background: #f6f6f6 none repeat scroll 0% 0%; left: 580px; visibility: visible;"><br clear="none"/></div></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><br clear="none"/></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none; font: inherit; padding: 0px 4px;"><div style="height: 16px;"><div style="height: 16px;"><span>quad</span>.<span>size</span> / <span>dist</span> <span style="color: #3e999f;">&lt;</span> <span>theta</span></div></div></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><br clear="none"/></div><div style="z-index: 4; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><div style="z-index: 4; position: absolute; box-sizing: border-box; border-left: 2px solid; transform: translateZ(0px); opacity: 0.2; color: #aeafad; left: 176.8px; top: 0px; width: 7.2px; height: 16px;"><br clear="none"/></div></div></div></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: visible;"><br clear="none"/></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; font-size-adjust: inherit; font-kerning: inherit; font-language-override: inherit; font-feature-settings: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">Hint: make sure you use the <strong>distance</strong> to compute distance between points, the <strong>theta</strong> value for the condition, and <strong>addForce</strong> to add force contributions!</p><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">Before proceeding, make sure to run tests against your <strong>Quad</strong> and <strong>Body</strong> implementations.</p><h3 style="font-weight: normal; font-family: 'OpenSans', Arial, sans-serif; font-size: 16px; line-height: 24px;">The Sector Matrix</h3><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">The last data structure that we will implement is the <em>sector matrix</em>. In this data structure, we will use the auxiliary class <strong>Boundaries</strong>, which contains the <strong>minX</strong>, <strong>maxX</strong>, <strong>minY</strong> and <strong>maxY</strong> fields for the boundaries of the scene:</p><div style="position: relative; overflow: hidden; font: normal normal normal normal 12px 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', 'source-code-pro', monospace; direction: ltr; background-color: #ffffff; color: #4d4d4c; height: 114px;"><div style="position: absolute; overflow: hidden; width: auto; top: 0px; bottom: 0px; left: 0px; cursor: default; z-index: 4; background: #f6f6f6 none repeat scroll 0% 0%; color: #4d4d4c;"><div style="z-index: 1; position: relative; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 144px; width: 41px; box-sizing: border-box; pointer-events: auto; text-align: right; margin-top: 0px;"><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">1<span style="box-sizing: border-box; margin: 0px -12px 0px 1px; width: 11px; vertical-align: top; background-image: url(data:image/png; base64,ivborw0kggoaaaansuheugaaaauaaaafcayaaacnbyblaaaaneleqvr42mwksq0amazc8ixllrzqjzmbiejp0a6wwbcspgkaxolkqsot7nn3ymwr7pz32nzpkkvodbuxkaaaaabjru5erkjggg==&amp;quot;);background-repeat: no-repeat; background-position: center center; border-radius: 3px; border: 1px solid transparent; cursor: pointer; display: inline-block; height: 16px;"/></div><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">2</div><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">3</div><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">4</div><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">5</div><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">6</div><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">7</div></div><div style="position: absolute; left: 0px; right: 0px; background-color: #dcdcdc; top: 96px; height: 16px;"><br clear="none"/></div></div><div style="position: absolute; overflow: hidden; top: 0px; bottom: 0px; background-color: inherit; cursor: text; left: 41px; right: 0px;"><div style="position: absolute; box-sizing: border-box; min-width: 100%; margin-top: 0px; width: 542px; height: 144px; margin-left: 0px;"><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><div style="position: absolute; height: 100%; width: 1px; background: #f6f6f6 none repeat scroll 0% 0%; left: 580px; visibility: visible;"><br clear="none"/></div></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><div style="border-radius: 3px; position: absolute; z-index: 6; margin: -1px 0px 0px -1px; border: 1px solid #d1d1d1; height: 16px; width: 7.2px; top: 0px; left: 126.4px;"><br clear="none"/></div></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none; font: inherit; padding: 0px 4px;"><div style="height: 16px;"><div style="height: 16px;"><span style="color: #8959a8;">class</span> <span>Boundaries</span> <span>{</span></div></div><div style="height: 16px;"><div style="height: 16px;"><span style="color: #8959a8;">var</span> <span>minX</span>: <span style="color: #4271ae;">Float</span></div></div><div style="height: 16px;"><div style="height: 16px;"><span style="color: #8959a8;">var</span> <span>minY</span>: <span style="color: #4271ae;">Float</span></div></div><div style="height: 16px;"><div style="height: 16px;"><span style="color: #8959a8;">var</span> <span>maxX</span>: <span style="color: #4271ae;">Float</span></div></div><div style="height: 16px;"><div style="height: 16px;"><span style="color: #8959a8;">var</span> <span>maxY</span>: <span style="color: #4271ae;">Float</span></div></div><div style="height: 16px;"><div style="height: 16px;"><span style="color: #8959a8;">def</span> <span>size</span> <span style="color: #3e999f;">=</span> <span>math</span>.<span>max</span><span>(</span><span>maxX</span> <span style="color: #3e999f;">-</span> <span>minX</span>, <span>maxY</span> <span style="color: #3e999f;">-</span> <span>minY</span><span>)</span></div></div><div style="height: 16px;"><div style="height: 16px;"><span>}</span></div></div></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><br clear="none"/></div><div style="z-index: 4; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><div style="z-index: 4; position: absolute; box-sizing: border-box; border-left: 2px solid; transform: translateZ(0px); opacity: 0.2; color: #aeafad; left: 11.2px; top: 96px; width: 7.2px; height: 16px;"><br clear="none"/></div></div></div></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: visible;"><br clear="none"/></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; font-size-adjust: inherit; font-kerning: inherit; font-language-override: inherit; font-feature-settings: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">We will also rely on the <strong>ConcBuffer</strong> data structure, mentioned in the lecture:</p><div style="position: relative; overflow: hidden; font: normal normal normal normal 12px 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', 'source-code-pro', monospace; direction: ltr; background-color: #ffffff; color: #4d4d4c; height: 50px;"><div style="position: absolute; overflow: hidden; width: auto; top: 0px; bottom: 0px; left: 0px; cursor: default; z-index: 4; background: #f6f6f6 none repeat scroll 0% 0%; color: #4d4d4c;"><div style="z-index: 1; position: relative; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 80px; width: 41px; box-sizing: border-box; pointer-events: auto; text-align: right; margin-top: 0px;"><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">1</div></div><div style="position: absolute; left: 0px; right: 0px; background-color: #dcdcdc; top: 0px; height: 16px;"><br clear="none"/></div></div><div style="position: absolute; overflow: hidden; top: 0px; bottom: 0px; background-color: inherit; cursor: text; left: 41px; right: 0px;"><div style="position: absolute; box-sizing: border-box; min-width: 100%; margin-top: 0px; width: 542px; height: 80px; margin-left: 0px;"><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><div style="position: absolute; height: 100%; width: 1px; background: #f6f6f6 none repeat scroll 0% 0%; left: 580px; visibility: visible;"><br clear="none"/></div></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><div style="border-radius: 3px; position: absolute; z-index: 6; margin: -1px 0px 0px -1px; border: 1px solid #d1d1d1; height: 16px; width: 7.2px; top: 0px; left: 119.2px;"><br clear="none"/></div></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none; font: inherit; padding: 0px 4px;"><div style="height: 16px;"><div style="height: 16px;"><span style="color: #8959a8;">class</span> <span>ConcBuffer</span><span>[</span><span>T</span><span>]</span></div></div></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><br clear="none"/></div><div style="z-index: 4; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><div style="z-index: 4; position: absolute; box-sizing: border-box; border-left: 2px solid; transform: translateZ(0px); opacity: 0.2; color: #aeafad; left: 140.8px; top: 0px; width: 7.2px; height: 16px;"><br clear="none"/></div></div></div></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: visible;"><br clear="none"/></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; font-size-adjust: inherit; font-kerning: inherit; font-language-override: inherit; font-feature-settings: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">The <strong>ConcBuffer</strong> class comes with efficient <strong>+=</strong>, <strong>combine</strong> and <strong>foreach</strong> operations, which add elements into the buffer, combine two buffers and traverse the buffer, respectively. The sector matrix additionally has the <strong>toQuad</strong> method, which returns a quadtree that contains all the elements previously added with the <strong>+=</strong> method. Recall from the lectures that this combination of methods make the <strong>ConcBuffer</strong> a <em>combiner</em>.</p><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">The <strong>SectorMatrix</strong> is just a square matrix that covers a square region of space specified by the boundaries:</p><div style="position: relative; overflow: hidden; font: normal normal normal normal 12px 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', 'source-code-pro', monospace; direction: ltr; background-color: #ffffff; color: #4d4d4c; height: 112px;"><div style="position: absolute; overflow: hidden; width: auto; top: 0px; bottom: 0px; left: 0px; cursor: default; z-index: 4; background: #f6f6f6 none repeat scroll 0% 0%; color: #4d4d4c;"><div style="z-index: 1; position: relative; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 144px; width: 41px; box-sizing: border-box; pointer-events: auto; text-align: right; margin-top: 0px;"><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">1<span style="box-sizing: border-box; margin: 0px -12px 0px 1px; width: 11px; vertical-align: top; background-image: url(data:image/png; base64,ivborw0kggoaaaansuheugaaaauaaaafcayaaacnbyblaaaaneleqvr42mwksq0amazc8ixllrzqjzmbiejp0a6wwbcspgkaxolkqsot7nn3ymwr7pz32nzpkkvodbuxkaaaaabjru5erkjggg==&amp;quot;);background-repeat: no-repeat; background-position: center center; border-radius: 3px; border: 1px solid transparent; cursor: pointer; display: inline-block; height: 16px;"/></div><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">2</div><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 32px;">3</div><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">4</div><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">5</div><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">6</div></div><div style="position: absolute; left: 0px; right: 0px; background-color: #dcdcdc; top: 96px; height: 16px;"><br clear="none"/></div></div><div style="position: absolute; overflow: hidden; top: 0px; bottom: 0px; background-color: inherit; cursor: text; left: 41px; right: 0px;"><div style="position: absolute; box-sizing: border-box; min-width: 100%; margin-top: 0px; width: 542px; height: 144px; margin-left: 0px;"><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><div style="position: absolute; height: 100%; width: 1px; background: #f6f6f6 none repeat scroll 0% 0%; left: 580px; visibility: visible;"><br clear="none"/></div></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><div style="border-radius: 3px; position: absolute; z-index: 6; margin: -1px 0px 0px -1px; border: 1px solid #d1d1d1; height: 16px; width: 7.2px; top: 0px; left: 529.6px;"><br clear="none"/></div></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none; font: inherit; padding: 0px 4px;"><div style="height: 16px;"><div style="height: 16px;"><span style="color: #8959a8;">class</span> <span>SectorMatrix</span><span>(</span><span style="color: #8959a8;">val</span> <span>boundaries</span>: <span>Boundaries</span>, <span style="color: #8959a8;">val</span> <span>sectorPrecision</span>: <span style="color: #4271ae;">Int</span><span>)</span> <span>{</span></div></div><div style="height: 16px;"><div style="height: 16px;"><span style="color: #8959a8;">val</span> <span>sectorSize</span> <span style="color: #3e999f;">=</span> <span>boundaries</span>.<span>size</span> / <span>sectorPrecision</span></div></div><div style="height: 32px;"><div style="height: 16px;"><span style="color: #8959a8;">val</span> <span>matrix</span> <span style="color: #3e999f;">=</span> <span style="color: #8959a8;">new</span> <span style="color: #4271ae;">Array</span><span>[</span><span>ConcBuffer</span><span>[</span><span>Body</span><span>]]</span><span>(</span><span>sectorPrecision</span> <span style="color: #3e999f;">*</span></div><div style="height: 16px;">    <span>sectorPrecision</span><span>)</span></div></div><div style="height: 16px;"><div style="height: 16px;"><span style="color: #8959a8;">for</span> <span>(</span><span>i</span> <span style="color: #3e999f;">&lt;-</span> <span style="color: #f5871f;">0</span> <span>until</span> <span>matrix</span>.<span>length</span><span>)</span> <span>matrix</span><span>(</span><span>i</span><span>)</span> <span style="color: #3e999f;">=</span> <span style="color: #8959a8;">new</span> <span>ConcBuffer</span></div></div><div style="height: 16px;"><div style="height: 16px;"><span style="color: #8959a8;">def</span> <span>apply</span><span>(</span><span>x</span>: <span style="color: #4271ae;">Int</span>, <span>y</span>: <span style="color: #4271ae;">Int</span><span>)</span> <span style="color: #3e999f;">=</span> <span>matrix</span><span>(</span><span>y</span> <span style="color: #3e999f;">*</span> <span>sectorPrecision</span> <span style="color: #3e999f;">+</span> <span>x</span><span>)</span></div></div><div style="height: 16px;"><div style="height: 16px;"><span>}</span></div></div></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><br clear="none"/></div><div style="z-index: 4; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><div style="z-index: 4; position: absolute; box-sizing: border-box; border-left: 2px solid; transform: translateZ(0px); opacity: 0.2; color: #aeafad; left: 11.2px; top: 96px; width: 7.2px; height: 16px;"><br clear="none"/></div></div></div></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: visible;"><br clear="none"/></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; font-size-adjust: inherit; font-kerning: inherit; font-language-override: inherit; font-feature-settings: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">The <strong>sectorPrecision</strong> argument denotes the width and height of the matrix, and each entry contains a <strong>ConcBuffer[Body]</strong> object. Effectively, the <strong>SectorMatrix</strong> is a <em>combiner</em> -- it partitions the square region of space into <strong>sectorPrecision</strong> times <strong>sectorPrecision</strong> buckets, called <em>sectors</em>.</p><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;"><br clear="none"/></p><div><img src="Barnes-Hut%20Simulation%20%7C%20Coursera.resources/SZJJqNoKEeWv6g6eMxXZ9Q_cd9cf67174433423e7db38af13bb0995_sectormatrix.png" height="234" width="473"/></div><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">Combiners such as the <strong>SectorMatrix</strong> are used in parallel programming to partition the results into some intermediate form that is more amenable to parallelization. Recall from the lecture that one of the ways to implement a <em>combiner</em> is by using a bucket data structure -- we will do exactly that in this part of the exercise! We will add three methods on the <strong>SectorMatrix </strong>that will make it a combiner. We start with the <strong>+=</strong> method:</p><div style="position: relative; overflow: hidden; font: normal normal normal normal 12px 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', 'source-code-pro', monospace; direction: ltr; background-color: #ffffff; color: #4d4d4c; height: 66px;"><div style="position: absolute; overflow: hidden; width: auto; top: 0px; bottom: 0px; left: 0px; cursor: default; z-index: 4; background: #f6f6f6 none repeat scroll 0% 0%; color: #4d4d4c;"><div style="z-index: 1; position: relative; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 96px; width: 41px; box-sizing: border-box; pointer-events: auto; text-align: right; margin-top: 0px;"><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">1<span style="box-sizing: border-box; margin: 0px -12px 0px 1px; width: 11px; vertical-align: top; background-image: url(data:image/png; base64,ivborw0kggoaaaansuheugaaaauaaaafcayaaacnbyblaaaaneleqvr42mwksq0amazc8ixllrzqjzmbiejp0a6wwbcspgkaxolkqsot7nn3ymwr7pz32nzpkkvodbuxkaaaaabjru5erkjggg==&amp;quot;);background-repeat: no-repeat; background-position: center center; border-radius: 3px; border: 1px solid transparent; cursor: pointer; display: inline-block; height: 16px;"/></div><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">2</div><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">3</div><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">4</div></div><div style="position: absolute; left: 0px; right: 0px; background-color: #dcdcdc; top: 48px; height: 16px;"><br clear="none"/></div></div><div style="position: absolute; overflow: hidden; top: 0px; bottom: 0px; background-color: inherit; cursor: text; left: 41px; right: 0px;"><div style="position: absolute; box-sizing: border-box; min-width: 100%; margin-top: 0px; width: 542px; height: 96px; margin-left: 0px;"><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><div style="position: absolute; height: 100%; width: 1px; background: #f6f6f6 none repeat scroll 0% 0%; left: 580px; visibility: visible;"><br clear="none"/></div></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><div style="border-radius: 3px; position: absolute; z-index: 6; margin: -1px 0px 0px -1px; border: 1px solid #d1d1d1; height: 16px; width: 7.2px; top: 0px; left: 234.4px;"><br clear="none"/></div></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none; font: inherit; padding: 0px 4px;"><div style="height: 16px;"><div style="height: 16px;"><span style="color: #8959a8;">def</span> <span style="color: #3e999f;">+=</span><span>(</span><span>b</span>: <span>Body</span><span>)</span>: <span>SectorMatrix</span> <span style="color: #3e999f;">=</span> <span>{</span></div></div><div style="height: 16px;"><div style="height: 16px;">???</div></div><div style="height: 16px;"><div style="height: 16px;"><span style="color: #8959a8;">this</span></div></div><div style="height: 16px;"><div style="height: 16px;"><span>}</span></div></div></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><br clear="none"/></div><div style="z-index: 4; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><div style="z-index: 4; position: absolute; box-sizing: border-box; border-left: 2px solid; transform: translateZ(0px); opacity: 0.2; color: #aeafad; left: 11.2px; top: 48px; width: 7.2px; height: 16px;"><br clear="none"/></div></div></div></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: visible;"><br clear="none"/></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; font-size-adjust: inherit; font-kerning: inherit; font-language-override: inherit; font-feature-settings: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">This method should use the body position, <strong>boundaries</strong> and <strong>sectorPrecision</strong> to determine the sector into which the body should go into, and add the body into the corresponding <strong>ConcBuffer</strong> object.</p><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">Importantly, if the <strong>Body</strong> lies outside of the <strong>Boundaries</strong>, it should be considered to be located at the closest point within the<strong> Boundaries</strong> for the purpose of finding which <strong>ConcBuffer</strong> should hold the body.</p><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">Next, we implement the <strong>combine</strong> method, which takes another <strong>SectorMatrix</strong>, and creates a <strong>SectorMatrix</strong> which contains the elements of both input <strong>SectorMatrix</strong> data structures:</p><div style="position: relative; overflow: hidden; font: normal normal normal normal 12px 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', 'source-code-pro', monospace; direction: ltr; background-color: #ffffff; color: #4d4d4c; height: 50px;"><div style="position: absolute; overflow: hidden; width: auto; top: 0px; bottom: 0px; left: 0px; cursor: default; z-index: 4; background: #f6f6f6 none repeat scroll 0% 0%; color: #4d4d4c;"><div style="z-index: 1; position: relative; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 80px; width: 41px; box-sizing: border-box; pointer-events: auto; text-align: right; margin-top: 0px;"><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">1</div></div><div style="position: absolute; left: 0px; right: 0px; background-color: #dcdcdc; top: 0px; height: 16px;"><br clear="none"/></div></div><div style="position: absolute; overflow: hidden; top: 0px; bottom: 0px; background-color: inherit; cursor: text; left: 41px; right: 0px;"><div style="position: absolute; box-sizing: border-box; min-width: 100%; margin-top: 0px; width: 542px; height: 80px; margin-left: 0px;"><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><div style="position: absolute; height: 100%; width: 1px; background: #f6f6f6 none repeat scroll 0% 0%; left: 580px; visibility: visible;"><br clear="none"/></div></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><br clear="none"/></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none; font: inherit; padding: 0px 4px;"><div style="height: 16px;"><div style="height: 16px;"><span style="color: #8959a8;">def</span> <span>combine</span><span>(</span><span>that</span>: <span>SectorMatrix</span><span>)</span>: <span>SectorMatrix</span></div></div></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><br clear="none"/></div><div style="z-index: 4; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><div style="z-index: 4; position: absolute; box-sizing: border-box; border-left: 2px solid; transform: translateZ(0px); opacity: 0.2; color: #aeafad; left: 328px; top: 0px; width: 7.2px; height: 16px;"><br clear="none"/></div></div></div></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: visible;"><br clear="none"/></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; font-size-adjust: inherit; font-kerning: inherit; font-language-override: inherit; font-feature-settings: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">This method calls <strong>combine</strong> on the pair of <strong>ConcBuffers</strong> in <strong>this</strong> and <strong>that</strong> matrices to produce the <strong>ConcBuffer</strong> for the resulting matrix. You can safely assume that combine will only be called on matrices of same dimensions, boundaries and sector precision.</p><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;"><br clear="none"/></p><div><img src="Barnes-Hut%20Simulation%20%7C%20Coursera.resources/Uyx6ytoKEeW_sw71ba-y-Q_dbc804e690e2d2bf6ec789bfeffc5c70_combine.png" height="111" width="450"/></div><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">The nice thing about the sector matrix is that a quadtree can be constructed in parallel for each sector. Those little quadtrees can then be linked together. The <strong>toQuad</strong> method on the <strong>SectorMatrix </strong>does this:</p><div style="position: relative; overflow: hidden; font: normal normal normal normal 12px 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', 'source-code-pro', monospace; direction: ltr; background-color: #ffffff; color: #4d4d4c; height: 50px;"><div style="position: absolute; overflow: hidden; width: auto; top: 0px; bottom: 0px; left: 0px; cursor: default; z-index: 4; background: #f6f6f6 none repeat scroll 0% 0%; color: #4d4d4c;"><div style="z-index: 1; position: relative; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 80px; width: 41px; box-sizing: border-box; pointer-events: auto; text-align: right; margin-top: 0px;"><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">1</div></div><div style="position: absolute; left: 0px; right: 0px; background-color: #dcdcdc; top: 0px; height: 16px;"><br clear="none"/></div></div><div style="position: absolute; overflow: hidden; top: 0px; bottom: 0px; background-color: inherit; cursor: text; left: 41px; right: 0px;"><div style="position: absolute; box-sizing: border-box; min-width: 100%; margin-top: 0px; width: 542px; height: 80px; margin-left: 0px;"><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><div style="position: absolute; height: 100%; width: 1px; background: #f6f6f6 none repeat scroll 0% 0%; left: 580px; visibility: visible;"><br clear="none"/></div></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><br clear="none"/></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none; font: inherit; padding: 0px 4px;"><div style="height: 16px;"><div style="height: 16px;"><span style="color: #8959a8;">def</span> <span>toQuad</span><span>(</span><span>parallelism</span>: <span style="color: #4271ae;">Int</span><span>)</span>: <span>Quad</span></div></div></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><br clear="none"/></div><div style="z-index: 4; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><div style="z-index: 4; position: absolute; box-sizing: border-box; border-left: 2px solid; transform: translateZ(0px); opacity: 0.2; color: #aeafad; left: 248.8px; top: 0px; width: 7.2px; height: 16px;"><br clear="none"/></div></div></div></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: visible;"><br clear="none"/></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; font-size-adjust: inherit; font-kerning: inherit; font-language-override: inherit; font-feature-settings: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">This method is already implemented -- you can examine it if you would like to know how it works.</p><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">Congratulations, you just implemented your first combiner! Before proceeding, make sure to run those unit tests.</p><h2 style="font-weight: normal; margin-bottom: 10px; font-family: 'OpenSans', Arial, sans-serif; font-size: 22px; line-height: 24px;">Implementing Barnes-Hut</h2><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">Now that we have all the right data structures ready and polished, implementing Barnes-Hut becomes a piece of cake.</p><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">Take a look at the file <strong>Simulator.scala</strong>, which contains the implementation of the Barnes-Hut simulator, and in particular the<strong> step </strong>method. The step method represents one <strong>step</strong> in the simulation:</p><div style="position: relative; overflow: hidden; font: normal normal normal normal 12px 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', 'source-code-pro', monospace; direction: ltr; background-color: #ffffff; color: #4d4d4c; height: 288px;"><div style="position: absolute; overflow: hidden; width: auto; top: 0px; bottom: 0px; left: 0px; cursor: default; z-index: 4; background: #f6f6f6 none repeat scroll 0% 0%; color: #4d4d4c;"><div style="z-index: 1; position: relative; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 320px; width: 48px; box-sizing: border-box; pointer-events: auto; text-align: right; margin-top: 0px;"><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">1<span style="box-sizing: border-box; margin: 0px -12px 0px 1px; width: 11px; vertical-align: top; background-image: url(data:image/png; base64,ivborw0kggoaaaansuheugaaaauaaaafcayaaacnbyblaaaaneleqvr42mwksq0amazc8ixllrzqjzmbiejp0a6wwbcspgkaxolkqsot7nn3ymwr7pz32nzpkkvodbuxkaaaaabjru5erkjggg==&amp;quot;);background-repeat: no-repeat; background-position: center center; border-radius: 3px; border: 1px solid transparent; cursor: pointer; display: inline-block; height: 16px;"/></div><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">2</div><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">3</div><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">4</div><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">5</div><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">6</div><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">7</div><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">8</div><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">9</div><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">10</div><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">11</div><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">12</div><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">13</div><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">14</div><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">15</div><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">16</div><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">17</div><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">18</div></div><div style="position: absolute; left: 0px; right: 0px; background-color: #dcdcdc; top: 272px; height: 16px;"><br clear="none"/></div></div><div style="position: absolute; overflow: hidden; top: 0px; bottom: 0px; background-color: inherit; cursor: text; left: 48px; right: 0px;"><div style="position: absolute; box-sizing: border-box; min-width: 100%; margin-top: 0px; width: 535px; height: 320px; margin-left: 0px;"><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><div style="position: absolute; height: 100%; width: 1px; background: #f6f6f6 none repeat scroll 0% 0%; left: 580px; visibility: visible;"><br clear="none"/></div></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><div style="border-radius: 3px; position: absolute; z-index: 6; margin: -1px 0px 0px -1px; border: 1px solid #d1d1d1; height: 16px; width: 7.2px; top: 0px; left: 356.8px;"><br clear="none"/></div></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none; font: inherit; padding: 0px 4px;"><div style="height: 16px;"><div style="height: 16px;"><span style="color: #8959a8;">def</span> <span>step</span><span>(</span><span>bodies</span>: <span style="color: #4271ae;">Seq</span><span>[</span><span>Body</span><span>])</span>: <span>(</span><span style="color: #4271ae;">Seq</span><span>[</span><span>Body</span><span>]</span>, <span>Quad</span><span>)</span> <span style="color: #3e999f;">=</span> <span>{</span></div></div><div style="height: 16px;"><div style="height: 16px;"><span style="color: #8e908c;">// 1. compute boundaries</span></div></div><div style="height: 16px;"><div style="height: 16px;"><span style="color: #8959a8;">val</span> <span>boundaries</span> <span style="color: #3e999f;">=</span> <span>computeBoundaries</span><span>(</span><span>bodies</span><span>)</span></div></div><div style="height: 16px;"><div style="height: 16px;"><br clear="none"/></div></div><div style="height: 16px;"><div style="height: 16px;"><span style="color: #8e908c;">// 2. compute sector matrix</span></div></div><div style="height: 16px;"><div style="height: 16px;"><span style="color: #8959a8;">val</span> <span>sectorMatrix</span> <span style="color: #3e999f;">=</span> <span>computeSectorMatrix</span><span>(</span><span>bodies</span>, <span>boundaries</span><span>)</span></div></div><div style="height: 16px;"><div style="height: 16px;"><br clear="none"/></div></div><div style="height: 16px;"><div style="height: 16px;"><span style="color: #8e908c;">// 3. compute quadtree</span></div></div><div style="height: 16px;"><div style="height: 16px;"><span style="color: #8959a8;">val</span> <span>quad</span> <span style="color: #3e999f;">=</span> <span>computeQuad</span><span>(</span><span>sectorMatrix</span><span>)</span></div></div><div style="height: 16px;"><div style="height: 16px;"><br clear="none"/></div></div><div style="height: 16px;"><div style="height: 16px;"><span style="color: #8e908c;">// 4. eliminate outliers</span></div></div><div style="height: 16px;"><div style="height: 16px;"><span style="color: #8959a8;">val</span> <span>filteredBodies</span> <span style="color: #3e999f;">=</span> <span>eliminateOutliers</span><span>(</span><span>bodies</span>, <span>sectorMatrix</span>, <span>quad</span><span>)</span></div></div><div style="height: 16px;"><div style="height: 16px;"><br clear="none"/></div></div><div style="height: 16px;"><div style="height: 16px;"><span style="color: #8e908c;">// 5. update body velocities and positions</span></div></div><div style="height: 16px;"><div style="height: 16px;"><span style="color: #8959a8;">val</span> <span>newBodies</span> <span style="color: #3e999f;">=</span> <span>updateBodies</span><span>(</span><span>filteredBodies</span>, <span>quad</span><span>)</span></div></div><div style="height: 16px;"><div style="height: 16px;"><br clear="none"/></div></div><div style="height: 16px;"><div style="height: 16px;"><span>(</span><span>newBodies</span>, <span>quad</span><span>)</span></div></div><div style="height: 16px;"><div style="height: 16px;"><span>}</span></div></div></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><br clear="none"/></div><div style="z-index: 4; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><div style="z-index: 4; position: absolute; box-sizing: border-box; border-left: 2px solid; transform: translateZ(0px); opacity: 0.2; color: #aeafad; left: 11.2px; top: 272px; width: 7.2px; height: 16px;"><br clear="none"/></div></div></div></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: visible;"><br clear="none"/></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; font-size-adjust: inherit; font-kerning: inherit; font-language-override: inherit; font-feature-settings: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">The pre-existing code in <strong>step</strong> nicely summarizes what this method does.</p><h3 style="font-weight: normal; font-family: 'OpenSans', Arial, sans-serif; font-size: 16px; line-height: 24px;">Computing the Scene Boundaries</h3><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">First, we must compute the boundaries of all the bodies in the scene. Since bodies move and the boundaries dynamically change, we must do this in every iteration of the algorithm. The <strong>computeBoundaries</strong> method is already implemented -- it uses the <strong>aggregate</strong> combinator on the sequence of bodies to compute the boundaries:</p><div style="position: relative; overflow: hidden; font: normal normal normal normal 12px 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', 'source-code-pro', monospace; direction: ltr; background-color: #ffffff; color: #4d4d4c; height: 80px;"><div style="position: absolute; overflow: hidden; width: auto; top: 0px; bottom: 0px; left: 0px; cursor: default; z-index: 4; background: #f6f6f6 none repeat scroll 0% 0%; color: #4d4d4c;"><div style="z-index: 1; position: relative; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 112px; width: 41px; box-sizing: border-box; pointer-events: auto; text-align: right; margin-top: 0px;"><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">1<span style="box-sizing: border-box; margin: 0px -12px 0px 1px; width: 11px; vertical-align: top; background-image: url(data:image/png; base64,ivborw0kggoaaaansuheugaaaauaaaafcayaaacnbyblaaaaneleqvr42mwksq0amazc8ixllrzqjzmbiejp0a6wwbcspgkaxolkqsot7nn3ymwr7pz32nzpkkvodbuxkaaaaabjru5erkjggg==&amp;quot;);background-repeat: no-repeat; background-position: center center; border-radius: 3px; border: 1px solid transparent; cursor: pointer; display: inline-block; height: 16px;"/></div><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">2</div><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">3</div><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">4</div><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">5</div></div><div style="position: absolute; left: 0px; right: 0px; background-color: #dcdcdc; top: 64px; height: 16px;"><br clear="none"/></div></div><div style="position: absolute; overflow: hidden; top: 0px; bottom: 0px; background-color: inherit; cursor: text; left: 41px; right: 0px;"><div style="position: absolute; box-sizing: border-box; min-width: 100%; margin-top: 0px; width: 542px; height: 112px; margin-left: 0px;"><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><div style="position: absolute; height: 100%; width: 1px; background: #f6f6f6 none repeat scroll 0% 0%; left: 580px; visibility: visible;"><br clear="none"/></div></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><div style="border-radius: 3px; position: absolute; z-index: 6; margin: -1px 0px 0px -1px; border: 1px solid #d1d1d1; height: 16px; width: 7.2px; top: 0px; left: 400px;"><br clear="none"/></div></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none; font: inherit; padding: 0px 4px;"><div style="height: 16px;"><div style="height: 16px;"><span style="color: #8959a8;">def</span> <span>computeBoundaries</span><span>(</span><span>bodies</span>: <span style="color: #4271ae;">Seq</span><span>[</span><span>Body</span><span>])</span>: <span>Boundaries</span> <span style="color: #3e999f;">=</span> <span>{</span></div></div><div style="height: 16px;"><div style="height: 16px;"><span style="color: #8959a8;">val</span> <span>parBodies</span> <span style="color: #3e999f;">=</span> <span>bodies</span>.<span>par</span></div></div><div style="height: 16px;"><div style="height: 16px;"><span>parBodies</span>.<span>tasksupport</span> <span style="color: #3e999f;">=</span> <span>taskSupport</span></div></div><div style="height: 16px;"><div style="height: 16px;"><span>parBodies</span>.<span>aggregate</span><span>(</span><span style="color: #8959a8;">new</span> <span>Boundaries</span><span>)</span><span>(</span><span>updateBoundaries</span>, <span>mergeBoundaries</span><span>)</span></div></div><div style="height: 16px;"><div style="height: 16px;"><span>}</span></div></div></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><br clear="none"/></div><div style="z-index: 4; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><div style="z-index: 4; position: absolute; box-sizing: border-box; border-left: 2px solid; transform: translateZ(0px); opacity: 0.2; color: #aeafad; left: 11.2px; top: 64px; width: 7.2px; height: 16px;"><br clear="none"/></div></div></div></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: visible;"><br clear="none"/></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; font-size-adjust: inherit; font-kerning: inherit; font-language-override: inherit; font-feature-settings: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">How does this work? The <strong>aggregate</strong> method divides the input sequence into a number of chunks. For each of the chunks, it uses the <strong>new Boundaries</strong> expression to create the accumulation value, and then folds the values in that chunk calling <strong>updateBoundaries</strong> on each body, in the same way a <strong>foldLeft</strong> operation would. Finally, <strong>aggregate</strong> combines the results of different chunks using a reduction tree and <strong>mergeBoundaries</strong>.</p><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">So, we need the <strong>updateBoundaries</strong> method:</p><div style="position: relative; overflow: hidden; font: normal normal normal normal 12px 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', 'source-code-pro', monospace; direction: ltr; background-color: #ffffff; color: #4d4d4c; height: 50px;"><div style="position: absolute; overflow: hidden; width: auto; top: 0px; bottom: 0px; left: 0px; cursor: default; z-index: 4; background: #f6f6f6 none repeat scroll 0% 0%; color: #4d4d4c;"><div style="z-index: 1; position: relative; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 80px; width: 41px; box-sizing: border-box; pointer-events: auto; text-align: right; margin-top: 0px;"><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">1</div></div><div style="position: absolute; left: 0px; right: 0px; background-color: #dcdcdc; top: 0px; height: 16px;"><br clear="none"/></div></div><div style="position: absolute; overflow: hidden; top: 0px; bottom: 0px; background-color: inherit; cursor: text; left: 41px; right: 0px;"><div style="position: absolute; box-sizing: border-box; min-width: 100%; margin-top: 0px; width: 542px; height: 80px; margin-left: 0px;"><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><div style="position: absolute; height: 100%; width: 1px; background: #f6f6f6 none repeat scroll 0% 0%; left: 580px; visibility: visible;"><br clear="none"/></div></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><br clear="none"/></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none; font: inherit; padding: 0px 4px;"><div style="height: 16px;"><div style="height: 16px;"><span style="color: #8959a8;">def</span> <span>updateBoundaries</span><span>(</span><span>boundaries</span>: <span>Boundaries</span>, <span>body</span>: <span>Body</span><span>)</span>: <span>Boundaries</span></div></div></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><br clear="none"/></div><div style="z-index: 4; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><div style="z-index: 4; position: absolute; box-sizing: border-box; border-left: 2px solid; transform: translateZ(0px); opacity: 0.2; color: #aeafad; left: 493.6px; top: 0px; width: 7.2px; height: 16px;"><br clear="none"/></div></div></div></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: visible;"><br clear="none"/></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; font-size-adjust: inherit; font-kerning: inherit; font-language-override: inherit; font-feature-settings: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">Given an existing<strong> boundaries</strong> object and a body, the<strong> updateBoundaries</strong> updates the <strong>minX</strong>, <strong>minY</strong>, <strong>maxX </strong>and <strong>maxY</strong> values so that the boundaries include the body.</p><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">Next, the <strong>mergeBoundaries</strong> method creates a new <strong>Boundaries</strong> object, which represents the smallest rectangle that contains both the input boundaries:</p><div style="position: relative; overflow: hidden; font: normal normal normal normal 12px 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', 'source-code-pro', monospace; direction: ltr; background-color: #ffffff; color: #4d4d4c; height: 50px;"><div style="position: absolute; overflow: hidden; width: auto; top: 0px; bottom: 0px; left: 0px; cursor: default; z-index: 4; background: #f6f6f6 none repeat scroll 0% 0%; color: #4d4d4c;"><div style="z-index: 1; position: relative; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 80px; width: 41px; box-sizing: border-box; pointer-events: auto; text-align: right; margin-top: 0px;"><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">1</div></div><div style="position: absolute; left: 0px; right: 0px; background-color: #dcdcdc; top: 0px; height: 16px;"><br clear="none"/></div></div><div style="position: absolute; overflow: hidden; top: 0px; bottom: 0px; background-color: inherit; cursor: text; left: 41px; right: 0px;"><div style="position: absolute; box-sizing: border-box; min-width: 100%; margin-top: 0px; width: 542px; height: 80px; margin-left: 0px;"><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><div style="position: absolute; height: 100%; width: 1px; background: #f6f6f6 none repeat scroll 0% 0%; left: 580px; visibility: visible;"><br clear="none"/></div></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><br clear="none"/></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none; font: inherit; padding: 0px 4px;"><div style="height: 16px;"><div style="height: 16px;"><span style="color: #8959a8;">def</span> <span>mergeBoundaries</span><span>(</span><span>a</span>: <span>Boundaries</span>, <span>b</span>: <span>Boundaries</span><span>)</span>: <span>Boundaries</span></div></div></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><br clear="none"/></div><div style="z-index: 4; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><div style="z-index: 4; position: absolute; box-sizing: border-box; border-left: 2px solid; transform: translateZ(0px); opacity: 0.2; color: #aeafad; left: 443.2px; top: 0px; width: 7.2px; height: 16px;"><br clear="none"/></div></div></div></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: visible;"><br clear="none"/></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; font-size-adjust: inherit; font-kerning: inherit; font-language-override: inherit; font-feature-settings: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">Question: Is <strong>mergeBoundaries</strong> associative? Is it commutative? Does it need to be commutative?</p><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">Implement these two methods, and test that they work correctly!</p><h3 style="font-weight: normal; font-family: 'OpenSans', Arial, sans-serif; font-size: 16px; line-height: 24px;">Building the Quadtree</h3><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">Next, we need to build a <strong>Quad</strong> tree from the sequence of bodies. We will first implement the <strong>computeSectorMatrix</strong> method to get the <strong>SectorMatrix</strong>:</p><div style="position: relative; overflow: hidden; font: normal normal normal normal 12px 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', 'source-code-pro', monospace; direction: ltr; background-color: #ffffff; color: #4d4d4c; height: 50px;"><div style="position: absolute; overflow: hidden; width: auto; top: 0px; bottom: 0px; left: 0px; cursor: default; z-index: 4; background: #f6f6f6 none repeat scroll 0% 0%; color: #4d4d4c;"><div style="z-index: 1; position: relative; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 112px; width: 41px; box-sizing: border-box; pointer-events: auto; text-align: right; margin-top: 0px;"><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 32px;">1</div></div><div style="position: absolute; left: 0px; right: 0px; background-color: #dcdcdc; top: 0px; height: 32px;"><br clear="none"/></div></div><div style="position: absolute; overflow: hidden; top: 0px; bottom: 0px; background-color: inherit; cursor: text; left: 41px; right: 0px;"><div style="position: absolute; box-sizing: border-box; min-width: 100%; margin-top: 0px; width: 542px; height: 112px; margin-left: 0px;"><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><div style="position: absolute; height: 100%; width: 1px; background: #f6f6f6 none repeat scroll 0% 0%; left: 580px; visibility: visible;"><br clear="none"/></div></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><br clear="none"/></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none; font: inherit; padding: 0px 4px;"><div style="height: 32px;"><div style="height: 16px;"><span style="color: #8959a8;">def</span> <span>computeSectorMatrix</span><span>(</span><span>bodies</span>: <span style="color: #4271ae;">Seq</span><span>[</span><span>Body</span><span>]</span>, <span>boundaries</span>: <span>Boundaries</span><span>)</span>:</div><div style="height: 16px;">  <span>SectorMatrix</span></div></div></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><br clear="none"/></div><div style="z-index: 4; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><div style="z-index: 4; position: absolute; box-sizing: border-box; border-left: 2px solid; transform: translateZ(0px); opacity: 0.2; color: #aeafad; left: 104.8px; top: 16px; width: 7.2px; height: 16px;"><br clear="none"/></div></div></div></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: visible;"><br clear="none"/></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; font-size-adjust: inherit; font-kerning: inherit; font-language-override: inherit; font-feature-settings: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">Hint: aggregate the <strong>SectorMatrix</strong> from the sequence of bodies, the same way it was used for boundaries. Use the SECTOR_PRECISION constant when creating a new <strong>SectorMatrix</strong>.</p><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">Test that these methods work correctly before proceeding!</p><h3 style="font-weight: normal; font-family: 'OpenSans', Arial, sans-serif; font-size: 16px; line-height: 24px;">Eliminating Outliers</h3><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">During the execution of the Barnes-Hut algorithm, some of the bodies tend to move far away from most of the other bodies. There are many ways to deal with such <em>outliers</em>, but to keep things simple, we will eliminate bodies that move too fast and too far away.</p><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">We will not go into details of how this works, but if you'd like to know more, you can try to understand how the <strong>eliminateOutliers</strong> method works.</p><h3 style="font-weight: normal; font-family: 'OpenSans', Arial, sans-serif; font-size: 16px; line-height: 24px;">Updating Bodies</h3><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">The <strong>updateBodies </strong>method uses the quadtree to map each body from the previous iteration of the algorithm to a new iteration:</p><div style="position: relative; overflow: hidden; font: normal normal normal normal 12px 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', 'source-code-pro', monospace; direction: ltr; background-color: #ffffff; color: #4d4d4c; height: 50px;"><div style="position: absolute; overflow: hidden; width: auto; top: 0px; bottom: 0px; left: 0px; cursor: default; z-index: 4; background: #f6f6f6 none repeat scroll 0% 0%; color: #4d4d4c;"><div style="z-index: 1; position: relative; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 80px; width: 41px; box-sizing: border-box; pointer-events: auto; text-align: right; margin-top: 0px;"><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">1</div></div><div style="position: absolute; left: 0px; right: 0px; background-color: #dcdcdc; top: 0px; height: 16px;"><br clear="none"/></div></div><div style="position: absolute; overflow: hidden; top: 0px; bottom: 0px; background-color: inherit; cursor: text; left: 41px; right: 0px;"><div style="position: absolute; box-sizing: border-box; min-width: 100%; margin-top: 0px; width: 542px; height: 80px; margin-left: 0px;"><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><div style="position: absolute; height: 100%; width: 1px; background: #f6f6f6 none repeat scroll 0% 0%; left: 580px; visibility: visible;"><br clear="none"/></div></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><div style="border-radius: 3px; position: absolute; z-index: 6; margin: -1px 0px 0px -1px; border: 1px solid #d1d1d1; height: 16px; width: 7.2px; top: 0px; left: 378.40000000000003px;"><br clear="none"/></div></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none; font: inherit; padding: 0px 4px;"><div style="height: 16px;"><div style="height: 16px;"><span style="color: #8959a8;">def</span> <span>updateBodies</span><span>(</span><span>bodies</span>: <span style="color: #4271ae;">Seq</span><span>[</span><span>Body</span><span>]</span>, <span>quad</span>: <span>Quad</span><span>)</span>: <span style="color: #4271ae;">Seq</span><span>[</span><span>Body</span><span>]</span></div></div></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><br clear="none"/></div><div style="z-index: 4; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><div style="z-index: 4; position: absolute; box-sizing: border-box; border-left: 2px solid; transform: translateZ(0px); opacity: 0.2; color: #aeafad; left: 421.6px; top: 0px; width: 7.2px; height: 16px;"><br clear="none"/></div></div></div></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: visible;"><br clear="none"/></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; font-size-adjust: inherit; font-kerning: inherit; font-language-override: inherit; font-feature-settings: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">Recall that we already implemented the <strong>updated </strong>method which updates a single body.</p><h2 style="font-weight: normal; margin-bottom: 10px; font-family: 'OpenSans', Arial, sans-serif; font-size: 22px; line-height: 24px;">Running Barnes-Hut</h2><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">At last, the parallel Barnes-Hut algorithm is implemented. Note that, despite all the work, we kept our Barnes-Hut algorithm implementation simple and avoided the details that a more realistic implementation must address. In particular:</p><ul><li>we represented each body as a single point in space</li><li>we restricted the simulation to two-dimensional space</li><li>we ignored close encounter effects, such as body collision or tearing</li><li>we ignored any relativistic effects, and assume classical mechanics</li><li>we ignored errors induced by floating point computations</li></ul><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">You can now run it as follows:</p><div style="position: relative; overflow: hidden; font: normal normal normal normal 12px 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', 'source-code-pro', monospace; direction: ltr; background-color: #ffffff; color: #4d4d4c; height: 50px;"><div style="position: absolute; overflow: hidden; width: auto; top: 0px; bottom: 0px; left: 0px; cursor: default; z-index: 4; background: #f6f6f6 none repeat scroll 0% 0%; color: #4d4d4c;"><div style="z-index: 1; position: relative; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 80px; width: 41px; box-sizing: border-box; pointer-events: auto; text-align: right; margin-top: 0px;"><div style="padding-left: 19px; background-repeat: no-repeat; padding-right: 13px; height: 16px;">1</div></div><div style="position: absolute; left: 0px; right: 0px; background-color: #dcdcdc; top: 0px; height: 16px;"><br clear="none"/></div></div><div style="position: absolute; overflow: hidden; top: 0px; bottom: 0px; background-color: inherit; cursor: text; left: 41px; right: 0px;"><div style="position: absolute; box-sizing: border-box; min-width: 100%; margin-top: 0px; width: 542px; height: 80px; margin-left: 0px;"><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><div style="position: absolute; height: 100%; width: 1px; background: #f6f6f6 none repeat scroll 0% 0%; left: 580px; visibility: visible;"><br clear="none"/></div></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><br clear="none"/></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none; font: inherit; padding: 0px 4px;"><div style="height: 16px;"><div style="height: 16px;"><span style="color: #3e999f;">&gt;</span> <span>runMain</span> <span>barneshut</span>.<span>BarnesHut</span></div></div></div><div style="z-index: 1; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><br clear="none"/></div><div style="z-index: 4; position: absolute; overflow: hidden; overflow-wrap: normal; white-space: pre; height: 100%; width: 100%; box-sizing: border-box; pointer-events: none;"><div style="z-index: 4; position: absolute; box-sizing: border-box; border-left: 2px solid; transform: translateZ(0px); opacity: 0.2; color: #aeafad; left: 212.8px; top: 0px; width: 7.2px; height: 16px;"><br clear="none"/></div></div></div></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: visible;"><br clear="none"/></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; font-size-adjust: inherit; font-kerning: inherit; font-language-override: inherit; font-feature-settings: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">To visualize the quadtree, press the <em>Show quad</em> button, and then hit the <em>Start/Pause</em> button.</p><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;"><br clear="none"/></p><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;">Play with the parallelism level and the number of bodies, and observe the average speedups in the lower right corner. Then sit back, and enjoy the show!</p><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;"><br clear="none"/></p></div></div></div></div><div><div><div><h3>How to submit</h3><p style="font-size: 14px; line-height: 21px; font-family: 'OpenSans', Arial, sans-serif;"><span>Copy the token below and run the submission script included in the assignment download. When prompted, use your email address <strong>kirchnermarc@yahoo.com</strong>.</span></p><div><div><div><br clear="none"/></div><br clear="none"/></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div><div><br clear="none"/></div><div style="margin: 0px; padding: 0px; position: absolute; width: 5px; height: 5px; top: -10px; left: -10px;"><br clear="none"/></div></div></div></div><br clear="none"/></div></body></html>